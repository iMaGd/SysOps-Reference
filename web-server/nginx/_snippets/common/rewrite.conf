# Requires: $canonical_host
# Optional: $origin_proto from your global map (client scheme behind CDN)

# Redirect any non-canonical host to the canonical host (always HTTPS)
if ($host != $canonical_host) {
    return 301 https://$canonical_host$request_uri;
}

# Force HTTPS based on the *client* scheme (works behind CDN)
if ($origin_proto = http) {
    return 301 https://$canonical_host$request_uri;
}
